# Texture Mapping

This process involves pasting an image (like a decal) on the surface of a geometrical shape.

The role of the texture mapping process is to assign the texture image's pixel colors to the fragments generated by the rasterization. The pixels that make up the texture image are called **texels(texture elements)**, and each texel codes its color information in the RGB or RGBA format.

Texture mapping involves the following four steps in WebGL:

1. Prepare the image to be mapped on the geommetric shape.
2. Specify the image mapping method for the geometric shape.
3. Load the texture image and configure it for use in WebGL.
4. Extract the texels from the image in the fragment shader, and accordingly set the corresponding fragment

## Flipping an Image's Y-Axis

The t-axis direction of the WebGL texture coordinate system is the inverse of the y-axis direction of the coordinate system used by PNG, BMP, JPG etc. Therefore, flipping the image's Y-axis, you can map the image to a webgl shape correctly.

### gl.pixelStorei(pname, param)

---

Perform the process defined by pname and param after loading an image.

#### Parameters

- **pname** - Specifies any of the following:
  - gl.UNPACK_FLIP_Y_WEBGL - Flips an imageâ€™s Y-axis after loading the image. The default value is false.
  - gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL - Multiplies each component of RGB in an image by A in the image. The default value is false.
- **param** - Specifies none-zero (means true) or zero(means false). It must be specified in the integer.

#### Return value

- `None`

#### Errors

- INVALID_ENUM - pname is none of these values

## Making a Texture Unit Active (gl.activeTexture())

WebGl supports multiple texture images (multitexturing) using a mechanism called a **texture unit**. A texture unit manages texture images by using a unit number for each texture.

The number of texture units supported varies according to your hardware and WebGL implementation, but by default at least eight texture units are supported and some systems will support more.

Before using a texture unit, it must be made active using a call to gl.activeTexture()

---

### gl.activeTexture(texUnit)

---

Make the texture unit specified by texUnit active.

#### Parameters

- **textUnit** - Specifies the texture unit to be made active: gl.TEXTURE[01234567...]. The trailing number indicates the texture unit number.

#### Return value

- `None`

#### Errors

- INALID_ENUM - texUnit is none of these values

## Binding a Texture Object to a Target (gl.bindTexture())

The WebGL system needs to be told what types of texture image is used in the texture object. WebGL supports two types of textures:

- **gl.TEXTURE_2D** - Two-dimensional texture
- **gl.TEXTURE_CUBE_MAP** - Cube map texture

---

### gl.bindTexture(target, texture)

---

Enable the texture object specified by texture and bind it to the target. In addition, if a texture unit was made active by gl.activeTexture(), the texture object is also bound to the texture unit.

#### Parameters

- **target** - Specifies gl.TEXTURE_2D or gl.TEXTURE_CUBE_MAP.
- **texture** - Specifies the texture object to be bound.

#### Return value

- `None`

#### Errors

- INVALID_ENUM - target is none of these values.

## Set the Texture Parameters of a Texture Object (gl.texParameteri())

Texture parameters specify how the texture image will be processed when the texture image is mapped to shapes.

---

### gl.texParameteri(target, pname, param)

---

Set the value specified by param to the texture parameter specified by pname in the texture object bound to target.

#### Parameters

- **target** - Specifies gl.TEXTURE_2D or gl.TEXTURE_CUBE_MAP.
- **pname** - Specifies the name of the texture parameter.
- **param** - Specifies the value set to the texture parameter pname

#### Return value

- `None`

#### Errors

- INVALID_ENUM - target is none of the preceding values
- INVALID_OPERATION - no texture object is bound to target

There are four texture parameters available:

##### Magnification method (gl.TEXTURE_MAG_FILTER)

The method to magnify a texture image when you map the texture to a shape whose drawing area is larger that the size of the texture.

##### Minification method (gl.TEXTURE_MIN_FILTER)

The method of minifying a texture image when you map the texture to a shape whose drawing area is smaller that the size of the texture.

##### Wrapping method on the left and right side (gl.TEXTURE_WRAP_S)

How to fill the remaining regions on the left side and the right side of a subregion when you map a texture image to the subregion of a shape.

##### Wrapping method on top and bottom (gl.TEXTURE_WRAP_T)

The method used to fill the remaining regions in the top and bottom of a subregion.

```javascript
// Texture Parameters and their default values

Texture Parameter       Description                 Default Value
gl.TEXTURE_MAG_FILTER   Texture magnification       gl.LINEAR
gl.TEXTURE_MIN_FILTER   Texture minification        gl.NEAREST_MIPMAP_LINEAR
gl.TEXTURE_WRAP_S       Texture wrapping in s-axis  gl.REPEAT
gl.TEXTURE_WRAP_T       Texture wrapping in t-axis  gl.REPEAT
```

```javascript
// Non-Mipmapped values, Which can be specified to
// gl.TEXTURE_MAG_FILTER and
// gl.TEXTURE_MIN_FILTER

- gl.NEAREST
Uses the value of the texel that is nearest (in Manhattan distance) the center of the pixel being textured

- gl.LINEAR
Uses the weighted average of the four texels that are nearest the center of the pixel being textured. (The quality of the result is clearer than that of gl.NEAREST, but it takes more time.)
```

```javascript
// Values that can be specified to
// gl.TEXTURE_WRAP_S and
// gl.TEXTURE_WRAP_T

- gl.REPEAT
Use a texture image repeatedly

- gl.MIRRORED_REPEAT
Use a texture image mirrored-repeatedly

- gl.CLAMP_TO_EDGE
Use the edge color of a texture image
```

The default value of gl.TEXTURE_MIN_FILTER is for special texture format called **MIPMAP**. A **MIPMAP** is a sequence of textures, each of which is a progressively lower resolution representation of the same image.  
Other values can be specified for a MIPMAP texture:

- gl.NEAREST_MIPMAP_NEAREST
- gl.LINEAR_MIPMAP_NEAREST
- gl.NEAREST_MIPMAP_LINEAR
- gl.LINEAR_MIPMAP_LINEAR.

## Assigning a Texture Image to a Texture Object (gl.texImage2D())

In addition to assigning a texture to a texture object, this method allows you to tell the WebGL system about the image characteristics

---

### gl.texImage2D(target, level, internalformat, format, type, image)

---

Set the image specified by image to the texture object bound to target.

#### Parameters

- **target** - Specifies gl.TEXTURE_2D or gl.TEXTURE_CUBE_MAP.
- **level** - Specified as 0. (Actually, this parameter is used for a MIPMAP texture, which is not covered in this book.)
- **internalformat** - Specifies the internal format of the image.
- **format** - Specifies the format of the texel data. This must be specified using the same value as internalformat.
- **type** - Specifies the data type of the texel data.
- **image** - Specifies an Image object containing an image to be used as a texture.

#### Return value

- `None`

#### Errors

- INVALID_ENUM - target is none of the above values.
- NVALID_OPERATION - No texture object is bound to target

```javascript
// The Format of the Texel Data
Format                  Components in a Texel
gl.RGB                  Red, green, blue
gl.RGBA                 Red, green, blue, alpha
gl.ALPHA                (0.0, 0.0, 0.0, alpha)
gl.LUMINANCE            L, L, L, 1 L: Luminance
gl.LUMINANCE_ALPHA      L, L. L. alpha
```

**Luminance** is the perceived brightness oa a surface. It is often calculated as a weighted average of red, green, and blue color values that gives the perceived brightness of the surface.

```javascript
// The Data Type of Texel Data
Type                        Description
gl.UNSIGNED_BYTE            Unsigned byte format. Each color component has 1 byte.
gl.UNSIGNED_SHORT_5_6_5     RGB: Each component has 5, 6, and 5 bits, respectively.
gl.UNSIGNED_SHORT_4_4_4_4   RGBA: Each component has 4, 4, 4, and 4 bits, respectively.
gl.UNSIGNED_SHORT_5_5_5_1   RGBA: Each RGB component has 5 bits, and A has 1 bit.
```

## Passing the Texture Unit to the Fragment Shader (gl.uniform1i())

Once the texture image has been passed to the WebGL system, it must be passed to the fragment shader to map it to the surface of the shape. A uniform variable is used for this purpose since texture image does not change for each fragment.  
This uniform variable must be declared using the special data type for textures:

```javascript
// Special Data Types for Accessing a Texture

- sampler2D
Data type for accesing the texture bound to gl.TEXTURE_2D

- samplerCube
Data type for accesing the texture bound to gl.TEXTURE_CUBE_MAP
```

This method's second argument is the texture unit number ("n" in gl.TEXTUREn) of the texture unit that manages this texture object.


## Retrieve the Texel Color in a Fragment Shader (texture2D())
Retrieving a color of a texel from the texture image is done using the GLSL ES built in function **texture2D()** that reads out the texel color at a texture coordinate by specifying the texture unit number in the first parameter and the texture coordinates in the second parameter